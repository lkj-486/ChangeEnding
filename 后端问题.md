@storyweaver/api:dev: 🤖 MockLLM生成响应: {
@storyweaver/api:dev:   contentLength: 76,
@storyweaver/api:dev:   usage: { promptTokens: 62, completionTokens: 19, totalTokens: 81 }
@storyweaver/api:dev: }
@storyweaver/api:dev: 使用适配器 'mock' 成功生成响应
@storyweaver/api:dev: ✅ NarrativeAgent: LLM响应成功 {
@storyweaver/api:dev:   responseContentLength: 76,
@storyweaver/api:dev:   responsePreview: '冰冷的石墙，生锈的铁栅栏，还有远处传来的滴水声。艾伦在这个阴暗的地牢中醒来，头
脑中一片混乱。他必须想办法逃出这里，但首先需要了解周围的环境和可能的威胁。'
@storyweaver/api:dev: }
@storyweaver/api:dev: ✅ NarrativeAgent: 开场叙述生成成功 {
@storyweaver/api:dev:   id: 'narrative_1',
@storyweaver/api:dev:   type: 'description',
@storyweaver/api:dev:   contentLength: 76,
@storyweaver/api:dev:   contentPreview: '冰冷的石墙，生锈的铁栅栏，还有远处传来的滴水声。艾伦在这个阴暗的地牢中醒来，头 
脑中一片混乱。他必须想办法逃出这里，但首先需要了解周围的环境和可能的威胁。'
@storyweaver/api:dev: }
@storyweaver/api:dev: 生成叙述片段: description - 冰冷的石墙，生锈的铁栅栏，还有远处传来的滴水声。艾伦在这个阴暗的地牢中
醒来，头脑中一片混乱。他必须想...
@storyweaver/api:dev: 🔍 NarrativeAgent: 场景加载处理完成 { finalHistoryLength: 1 }
@storyweaver/api:dev: 🤖 MockLLM生成响应: {
@storyweaver/api:dev:   contentLength: 76,
@storyweaver/api:dev:   usage: { promptTokens: 62, completionTokens: 19, totalTokens: 81 }
@storyweaver/api:dev: }
@storyweaver/api:dev: 使用适配器 'mock' 成功生成响应
@storyweaver/api:dev: ✅ NarrativeAgent: LLM响应成功 {
@storyweaver/api:dev:   responseContentLength: 76,
@storyweaver/api:dev:   responsePreview: '冰冷的石墙，生锈的铁栅栏，还有远处传来的滴水声。艾伦在这个阴暗的地牢中醒来，头
脑中一片混乱。他必须想办法逃出这里，但首先需要了解周围的环境和可能的威胁。'
@storyweaver/api:dev: }
@storyweaver/api:dev: ✅ NarrativeAgent: 开场叙述生成成功 {
@storyweaver/api:dev:   id: 'narrative_1',
@storyweaver/api:dev:   type: 'description',
@storyweaver/api:dev:   contentLength: 76,
@storyweaver/api:dev:   contentPreview: '冰冷的石墙，生锈的铁栅栏，还有远处传来的滴水声。艾伦在这个阴暗的地牢中醒来，头 
脑中一片混乱。他必须想办法逃出这里，但首先需要了解周围的环境和可能的威胁。'
@storyweaver/api:dev: }
@storyweaver/api:dev: 生成叙述片段: description - 冰冷的石墙，生锈的铁栅栏，还有远处传来的滴水声。艾伦在这个阴暗的地牢中
醒来，头脑中一片混乱。他必须想...
@storyweaver/api:dev: 🔍 NarrativeAgent: 场景加载处理完成 { finalHistoryLength: 1 }
@storyweaver/api:dev: 🤖 MockLLM生成响应: {
@storyweaver/api:dev:   contentLength: 76,
@storyweaver/api:dev:   usage: { promptTokens: 62, completionTokens: 19, totalTokens: 81 }
@storyweaver/api:dev: }
@storyweaver/api:dev: 使用适配器 'mock' 成功生成响应
@storyweaver/api:dev: ✅ NarrativeAgent: LLM响应成功 {
@storyweaver/api:dev:   responseContentLength: 76,
@storyweaver/api:dev:   responsePreview: '冰冷的石墙，生锈的铁栅栏，还有远处传来的滴水声。艾伦在这个阴暗的地牢中醒来，头
脑中一片混乱。他必须想办法逃出这里，但首先需要了解周围的环境和可能的威胁。'
@storyweaver/api:dev: }
@storyweaver/api:dev: ✅ NarrativeAgent: 开场叙述生成成功 {
@storyweaver/api:dev:   id: 'narrative_1',
@storyweaver/api:dev:   type: 'description',
@storyweaver/api:dev:   contentLength: 76,
@storyweaver/api:dev:   contentPreview: '冰冷的石墙，生锈的铁栅栏，还有远处传来的滴水声。艾伦在这个阴暗的地牢中醒来，头 
脑中一片混乱。他必须想办法逃出这里，但首先需要了解周围的环境和可能的威胁。'
@storyweaver/api:dev: }
@storyweaver/api:dev: 生成叙述片段: description - 冰冷的石墙，生锈的铁栅栏，还有远处传来的滴水声。艾伦在这个阴暗的地牢中
醒来，头脑中一片混乱。他必须想...
@storyweaver/api:dev: 🔍 NarrativeAgent: 场景加载处理完成 { finalHistoryLength: 1 }
@storyweaver/api:dev: 📝 AI代理生成内容 #1 {
@storyweaver/api:dev:   action: 'narration',
@storyweaver/api:dev:   contextKeys: [
@storyweaver/api:dev:     'flow_stage',
@storyweaver/api:dev:     'focus',
@storyweaver/api:dev:     'mood',
@storyweaver/api:dev:     'style_guide',
@storyweaver/api:dev:     'target_length',
@storyweaver/api:dev:     'ai_orchestration'
@storyweaver/api:dev:   ],
@storyweaver/api:dev:   sceneId: 'escape-dungeon',
@storyweaver/api:dev:   flowStage: 'scene_opening'
@storyweaver/api:dev: }
@storyweaver/api:dev: 📝 生成narration内容 {
@storyweaver/api:dev:   focus: 'environment_description',
@storyweaver/api:dev:   mood: 'ominous',
@storyweaver/api:dev:   flowStage: 'scene_opening',
@storyweaver/api:dev:   targetLength: 180
@storyweaver/api:dev: }
@storyweaver/api:dev: 🔍 [StubAgentCore-helpers] generateStoryNarration 开始 {
@storyweaver/api:dev:   storyPhase: 'encounter',
@storyweaver/api:dev:   focus: 'environment_description',
@storyweaver/api:dev:   recentEventsCount: 1,
@storyweaver/api:dev:   variety: 5
@storyweaver/api:dev: }
@storyweaver/api:dev: 🎲 [StubAgentCore-helpers] 选择叙述模板 {
@storyweaver/api:dev:   templatesCount: 3,
@storyweaver/api:dev:   selectedTemplate: '远处传来脚步声，沉重而有节奏。有人正在接近这里。...',
@storyweaver/api:dev:   variety: 5
@storyweaver/api:dev: }
@storyweaver/api:dev: ✅ [StubAgentCore-helpers] 叙述内容生成完成 {
@storyweaver/api:dev:   type: 'narration',
@storyweaver/api:dev:   contentLength: 24,
@storyweaver/api:dev:   contentPreview: '远处传来脚步声，沉重而有节奏。有人正在接近这里。...',
@storyweaver/api:dev:   metadata: {
@storyweaver/api:dev:     style: 'environment_description',
@storyweaver/api:dev:     emotion: 'ominous',
@storyweaver/api:dev:     personalized: false,
@storyweaver/api:dev:     story_phase: 'encounter',
@storyweaver/api:dev:     current_scene: 1
@storyweaver/api:dev:   }
@storyweaver/api:dev: }
@storyweaver/api:dev: ✅ AI代理生成内容完成: {
@storyweaver/api:dev:   type: 'narration',
@storyweaver/api:dev:   contentLength: 24,
@storyweaver/api:dev:   responseTime: '803ms',
@storyweaver/api:dev:   flowStage: 'scene_opening'
@storyweaver/api:dev: }
@storyweaver/api:dev: 📝 AI生成内容: {
@storyweaver/api:dev:   type: 'narration',
@storyweaver/api:dev:   content: '远处传来脚步声，沉重而有节奏。有人正在接近这里。',
@storyweaver/api:dev:   metadata: {
@storyweaver/api:dev:     style: 'environment_description',
@storyweaver/api:dev:     emotion: 'ominous',
@storyweaver/api:dev:     personalized: true,
@storyweaver/api:dev:     story_phase: 'encounter',
@storyweaver/api:dev:     current_scene: 1,
@storyweaver/api:dev:     generation_time: 803,
@storyweaver/api:dev:     confidence: 0.8114876980092349,
@storyweaver/api:dev:     stub_version: '3.0.0',
@storyweaver/api:dev:     flow_stage: 'scene_opening'
@storyweaver/api:dev:   },
@storyweaver/api:dev:   timestamp: 1753775162656
@storyweaver/api:dev: }
@storyweaver/api:dev: 📢 [Director] 发布内容事件: {
@storyweaver/api:dev:   type: 'narration',
@storyweaver/api:dev:   contentPreview: '远处传来脚步声，沉重而有节奏。有人正在接近这里。...',
@storyweaver/api:dev:   contentLength: 24,
@storyweaver/api:dev:   hasMetadata: true,
@storyweaver/api:dev:   timestamp: '2025-07-29T07:46:02.656Z'
@storyweaver/api:dev: }
@storyweaver/api:dev: 🚀 [Director] 准备发布NARRATIVE_READY事件 {
@storyweaver/api:dev:   segmentId: 'narrative_1753775162656_5jv97ka6b',
@storyweaver/api:dev:   contentLength: 24,
@storyweaver/api:dev:   contentPreview: '远处传来脚步声，沉重而有节奏。有人正在接近这里。...',
@storyweaver/api:dev:   metadata: {
@storyweaver/api:dev:     style: 'environment_description',
@storyweaver/api:dev:     emotion: 'ominous',
@storyweaver/api:dev:     personalized: true,
@storyweaver/api:dev:     story_phase: 'encounter',
@storyweaver/api:dev:     current_scene: 1,
@storyweaver/api:dev:     generation_time: 803,
@storyweaver/api:dev:     confidence: 0.8114876980092349,
@storyweaver/api:dev:     stub_version: '3.0.0',
@storyweaver/api:dev:     flow_stage: 'scene_opening'
@storyweaver/api:dev:   }
@storyweaver/api:dev: }
@storyweaver/api:dev: 📡 [GameController] 收到NARRATIVE_READY事件 {
@storyweaver/api:dev:   type: 'narration',
@storyweaver/api:dev:   contentLength: 24,
@storyweaver/api:dev:   contentPreview: '远处传来脚步声，沉重而有节奏。有人正在接近这里。...',
@storyweaver/api:dev:   timestamp: '2025-07-29T07:46:02.656Z'
@storyweaver/api:dev: }
@storyweaver/api:dev: 📚 存储叙事内容 5ccd496b-9844-490e-99af-fb8a23d17bfb: { totalCount: 10, latestContent: '远处传来脚
步声，沉重而有节奏。有人正在接近这里。...' }
@storyweaver/api:dev: ✅ [GameController] 已发送干净的叙事内容到前端
@storyweaver/api:dev: 📡 [GameController] 收到NARRATIVE_READY事件 {
@storyweaver/api:dev:   type: 'narration',
@storyweaver/api:dev:   contentLength: 24,
@storyweaver/api:dev:   contentPreview: '远处传来脚步声，沉重而有节奏。有人正在接近这里。...',
@storyweaver/api:dev:   timestamp: '2025-07-29T07:46:02.656Z'
@storyweaver/api:dev: }
@storyweaver/api:dev: 📚 存储叙事内容 9674ac7b-a315-4875-8874-2d45903927aa: { totalCount: 6, latestContent: '远处传来脚 
步声，沉重而有节奏。有人正在接近这里。...' }
@storyweaver/api:dev: ✅ [GameController] 已发送干净的叙事内容到前端
@storyweaver/api:dev: 📡 [GameController] 收到NARRATIVE_READY事件 {
@storyweaver/api:dev:   type: 'narration',
@storyweaver/api:dev:   contentLength: 24,
@storyweaver/api:dev:   contentPreview: '远处传来脚步声，沉重而有节奏。有人正在接近这里。...',
@storyweaver/api:dev:   timestamp: '2025-07-29T07:46:02.656Z'
@storyweaver/api:dev: }
@storyweaver/api:dev: 📚 存储叙事内容 e4b46d0e-f854-4ab4-bb14-2bce6a8a8731: { totalCount: 1, latestContent: '远处传来脚 
步声，沉重而有节奏。有人正在接近这里。...' }
@storyweaver/api:dev: ✅ [GameController] 已发送干净的叙事内容到前端
@storyweaver/api:dev: ✅ [Director] NARRATIVE_READY事件已发布到事件总线 (narration)
@storyweaver/api:dev: 🎯 [Director] 启动游戏主循环 {
@storyweaver/api:dev:   tickInterval: 2500,
@storyweaver/api:dev:   cooldownDuration: 5000,
@storyweaver/api:dev:   availableAgents: [ 'hero', 'guard' ]
@storyweaver/api:dev: }
@storyweaver/api:dev: 🚀 主动触发初始叙事生成
@storyweaver/api:dev: 🎭 触发AI编排，原因: scene_entered
@storyweaver/api:dev: 🎭 AI编排器决策 #2 {
@storyweaver/api:dev:   availableActions: [ 'narration', 'dialogue', 'introspection', 'choice_point' ],
@storyweaver/api:dev:   trigger: 'scene_entered',
@storyweaver/api:dev:   sceneId: 'escape-dungeon',
@storyweaver/api:dev:   playerTraits: 0,
@storyweaver/api:dev:   recentEvents: 1
@storyweaver/api:dev: }
@storyweaver/api:dev: 🎭 AI编排器开始决策 {
@storyweaver/api:dev:   trigger: 'scene_entered',
@storyweaver/api:dev:   availableActions: [ 'narration', 'dialogue', 'introspection', 'choice_point' ],
@storyweaver/api:dev:   sceneId: 'escape-dungeon',
@storyweaver/api:dev:   recentEventsCount: 1
@storyweaver/api:dev: }
@storyweaver/api:dev: 🎬 场景开始：启动AI编排器-代理协作流程
@storyweaver/api:dev: ✅ AI编排器决策结果: {
@storyweaver/api:dev:   nextAction: 'narration',
@storyweaver/api:dev:   context: {
@storyweaver/api:dev:     flow_stage: 'scene_opening',
@storyweaver/api:dev:     focus: 'environment_description',
@storyweaver/api:dev:     mood: 'ominous',
@storyweaver/api:dev:     style_guide: 'atmospheric_immersive',
@storyweaver/api:dev:     target_length: 180,
@storyweaver/api:dev:     ai_orchestration: {
@storyweaver/api:dev:       is_multi_stage: true,
@storyweaver/api:dev:       current_stage: 1,
@storyweaver/api:dev:       total_stages: 3,
@storyweaver/api:dev:       next_trigger: 'ai_thinking_phase'
@storyweaver/api:dev:     }
@storyweaver/api:dev:   },
@storyweaver/api:dev:   confidence: 0.95,
@storyweaver/api:dev:   reasoning: '场景开始：启动完整AI编排流程 - 开场叙事 → AI思考 → 选择选项',
@storyweaver/api:dev:   timestamp: 1753775163491,
@storyweaver/api:dev:   responseTime: '834ms'
@storyweaver/api:dev: }
@storyweaver/api:dev: 🎯 AI决策结果: {
@storyweaver/api:dev:   nextAction: 'narration',
@storyweaver/api:dev:   context: {
@storyweaver/api:dev:     flow_stage: 'scene_opening',
@storyweaver/api:dev:     focus: 'environment_description',
@storyweaver/api:dev:     mood: 'ominous',
@storyweaver/api:dev:     style_guide: 'atmospheric_immersive',
@storyweaver/api:dev:     target_length: 180,
@storyweaver/api:dev:     ai_orchestration: {
@storyweaver/api:dev:       is_multi_stage: true,
@storyweaver/api:dev:       current_stage: 1,
@storyweaver/api:dev:       total_stages: 3,
@storyweaver/api:dev:       next_trigger: 'ai_thinking_phase'
@storyweaver/api:dev:     }
@storyweaver/api:dev:   },
@storyweaver/api:dev:   confidence: 0.95,
@storyweaver/api:dev:   reasoning: '场景开始：启动完整AI编排流程 - 开场叙事 → AI思考 → 选择选项',
@storyweaver/api:dev:   timestamp: 1753775163491
@storyweaver/api:dev: }
@storyweaver/api:dev: 📝 AI代理生成内容 #2 {
@storyweaver/api:dev:   action: 'narration',
@storyweaver/api:dev:   contextKeys: [
@storyweaver/api:dev:     'flow_stage',
@storyweaver/api:dev:     'focus',
@storyweaver/api:dev:     'mood',
@storyweaver/api:dev:     'style_guide',
@storyweaver/api:dev:     'target_length',
@storyweaver/api:dev:     'ai_orchestration'
@storyweaver/api:dev:   ],
@storyweaver/api:dev:   sceneId: 'escape-dungeon',
@storyweaver/api:dev:   flowStage: 'scene_opening'
@storyweaver/api:dev: }
@storyweaver/api:dev: 📝 生成narration内容 {
@storyweaver/api:dev:   focus: 'environment_description',
@storyweaver/api:dev:   mood: 'ominous',
@storyweaver/api:dev:   flowStage: 'scene_opening',
@storyweaver/api:dev:   targetLength: 180
@storyweaver/api:dev: }
@storyweaver/api:dev: 🔍 [StubAgentCore-helpers] generateStoryNarration 开始 {
@storyweaver/api:dev:   storyPhase: 'encounter',
@storyweaver/api:dev:   focus: 'environment_description',
@storyweaver/api:dev:   recentEventsCount: 1,
@storyweaver/api:dev:   variety: 5
@storyweaver/api:dev: }
@storyweaver/api:dev: 🎲 [StubAgentCore-helpers] 选择叙述模板 {
@storyweaver/api:dev:   templatesCount: 3,
@storyweaver/api:dev:   selectedTemplate: '微弱的光线从走廊尽头透过来，照亮了地面上的水渍和散落的稻草。...',
@storyweaver/api:dev:   variety: 5
@storyweaver/api:dev: }
@storyweaver/api:dev: ✅ [StubAgentCore-helpers] 叙述内容生成完成 {
@storyweaver/api:dev:   type: 'narration',
@storyweaver/api:dev:   contentLength: 30,
@storyweaver/api:dev:   contentPreview: '微弱的光线从走廊尽头透过来，照亮了地面上的水渍和散落的稻草。...',
@storyweaver/api:dev:   metadata: {
@storyweaver/api:dev:     style: 'environment_description',
@storyweaver/api:dev:     emotion: 'ominous',
@storyweaver/api:dev:     personalized: false,
@storyweaver/api:dev:     story_phase: 'encounter',
@storyweaver/api:dev:     current_scene: 1
@storyweaver/api:dev:   }
@storyweaver/api:dev: }
@storyweaver/api:dev: ✅ AI代理生成内容完成: {
@storyweaver/api:dev:   type: 'narration',
@storyweaver/api:dev:   contentLength: 30,
@storyweaver/api:dev:   responseTime: '812ms',
@storyweaver/api:dev:   flowStage: 'scene_opening'
@storyweaver/api:dev: }
@storyweaver/api:dev: 📝 AI生成内容: {
@storyweaver/api:dev:   type: 'narration',
@storyweaver/api:dev:   content: '微弱的光线从走廊尽头透过来，照亮了地面上的水渍和散落的稻草。',
@storyweaver/api:dev:   metadata: {
@storyweaver/api:dev:     style: 'environment_description',
@storyweaver/api:dev:     emotion: 'ominous',
@storyweaver/api:dev:     personalized: true,
@storyweaver/api:dev:     story_phase: 'encounter',
@storyweaver/api:dev:     current_scene: 1,
@storyweaver/api:dev:     generation_time: 812,
@storyweaver/api:dev:     confidence: 0.8051475183153477,
@storyweaver/api:dev:     stub_version: '3.0.0',
@storyweaver/api:dev:     flow_stage: 'scene_opening'
@storyweaver/api:dev:   },
@storyweaver/api:dev:   timestamp: 1753775164304
@storyweaver/api:dev: }
@storyweaver/api:dev: 📢 [Director] 发布内容事件: {
@storyweaver/api:dev:   type: 'narration',
@storyweaver/api:dev:   contentPreview: '微弱的光线从走廊尽头透过来，照亮了地面上的水渍和散落的稻草。...',
@storyweaver/api:dev:   contentLength: 30,
@storyweaver/api:dev:   hasMetadata: true,
@storyweaver/api:dev:   timestamp: '2025-07-29T07:46:04.304Z'
@storyweaver/api:dev: }
@storyweaver/api:dev: 🚀 [Director] 准备发布NARRATIVE_READY事件 {
@storyweaver/api:dev:   segmentId: 'narrative_1753775164304_yxlkxhmi4',
@storyweaver/api:dev:   contentLength: 30,
@storyweaver/api:dev:   contentPreview: '微弱的光线从走廊尽头透过来，照亮了地面上的水渍和散落的稻草。...',
@storyweaver/api:dev:   metadata: {
@storyweaver/api:dev:     style: 'environment_description',
@storyweaver/api:dev:     emotion: 'ominous',
@storyweaver/api:dev:     personalized: true,
@storyweaver/api:dev:     story_phase: 'encounter',
@storyweaver/api:dev:     current_scene: 1,
@storyweaver/api:dev:     generation_time: 812,
@storyweaver/api:dev:     confidence: 0.8051475183153477,
@storyweaver/api:dev:     stub_version: '3.0.0',
@storyweaver/api:dev:     flow_stage: 'scene_opening'
@storyweaver/api:dev:   }
@storyweaver/api:dev: }
@storyweaver/api:dev: 📡 [GameController] 收到NARRATIVE_READY事件 {
@storyweaver/api:dev:   type: 'narration',
@storyweaver/api:dev:   contentLength: 30,
@storyweaver/api:dev:   contentPreview: '微弱的光线从走廊尽头透过来，照亮了地面上的水渍和散落的稻草。...',
@storyweaver/api:dev:   timestamp: '2025-07-29T07:46:04.304Z'
@storyweaver/api:dev: }
@storyweaver/api:dev: 📚 存储叙事内容 5ccd496b-9844-490e-99af-fb8a23d17bfb: { totalCount: 10, latestContent: '微弱的光线
从走廊尽头透过来，照亮了地面上的水渍和散落的稻草。...' }
@storyweaver/api:dev: ✅ [GameController] 已发送干净的叙事内容到前端
@storyweaver/api:dev: 📡 [GameController] 收到NARRATIVE_READY事件 {
@storyweaver/api:dev:   type: 'narration',
@storyweaver/api:dev:   contentLength: 30,
@storyweaver/api:dev:   contentPreview: '微弱的光线从走廊尽头透过来，照亮了地面上的水渍和散落的稻草。...',
@storyweaver/api:dev:   timestamp: '2025-07-29T07:46:04.304Z'
@storyweaver/api:dev: }
@storyweaver/api:dev: 📚 存储叙事内容 9674ac7b-a315-4875-8874-2d45903927aa: { totalCount: 7, latestContent: '微弱的光线 
从走廊尽头透过来，照亮了地面上的水渍和散落的稻草。...' }
@storyweaver/api:dev: ✅ [GameController] 已发送干净的叙事内容到前端
@storyweaver/api:dev: 📡 [GameController] 收到NARRATIVE_READY事件 {
@storyweaver/api:dev:   type: 'narration',
@storyweaver/api:dev:   contentLength: 30,
@storyweaver/api:dev:   contentPreview: '微弱的光线从走廊尽头透过来，照亮了地面上的水渍和散落的稻草。...',
@storyweaver/api:dev:   timestamp: '2025-07-29T07:46:04.304Z'
@storyweaver/api:dev: }
@storyweaver/api:dev: 📚 存储叙事内容 e4b46d0e-f854-4ab4-bb14-2bce6a8a8731: { totalCount: 2, latestContent: '微弱的光线 
从走廊尽头透过来，照亮了地面上的水渍和散落的稻草。...' }
@storyweaver/api:dev: ✅ [GameController] 已发送干净的叙事内容到前端
@storyweaver/api:dev: ✅ [Director] NARRATIVE_READY事件已发布到事件总线 (narration)
@storyweaver/api:dev: ✅ 初始AI编排触发完成
@storyweaver/api:dev: 📝 等待叙事代理生成开场叙述...
@storyweaver/api:dev: ✅ 叙事代理已生成 1 个叙事片段
@storyweaver/api:dev: 🤖 激活AI代理 { aiAgentsCount: 2, aiAgentIds: [ 'hero', 'guard' ] }
@storyweaver/api:dev: 🚀 激活AI代理: hero
@storyweaver/api:dev: 🚀 激活AI代理 hero { wasActive: false, hasCurrentScene: true, sceneId: 'escape-dungeon' }
@storyweaver/api:dev: 🎬 AI代理 hero 有当前场景，等待Director调度
@storyweaver/api:dev: ✅ AI代理 hero 已激活
@storyweaver/api:dev: 🚀 激活AI代理: guard
@storyweaver/api:dev: 🚀 激活AI代理 guard { wasActive: false, hasCurrentScene: true, sceneId: 'escape-dungeon' }        
@storyweaver/api:dev: 🎬 AI代理 guard 有当前场景，等待Director调度
@storyweaver/api:dev: ✅ AI代理 guard 已激活
@storyweaver/api:dev: ⏳ 等待AI代理开始工作...
@storyweaver/api:dev: 🎯 [Director] Tick: 请求代理行动 { agentId: 'hero', sceneState: 'RUNNING', isWaitingForChoice: false }
@storyweaver/api:dev: 🎯 [AIAgent] hero 收到增强行动请求 {
@storyweaver/api:dev:   timestamp: '2025-07-29T07:46:05.171Z',
@storyweaver/api:dev:   context: { sceneId: 'escape-dungeon', sceneState: 'RUNNING' },
@storyweaver/api:dev:   hasNarrativeLedger: true
@storyweaver/api:dev: }
@storyweaver/api:dev: 🎯 [AIAgent] hero 开始智能决策响应 {
@storyweaver/api:dev:   actionCount: 0,
@storyweaver/api:dev:   maxActions: 10,
@storyweaver/api:dev:   sceneId: 'escape-dungeon',
@storyweaver/api:dev:   hasNarrativeLedger: true
@storyweaver/api:dev: }
@storyweaver/api:dev: 🎭 [AIAgent] hero 角色组件已更新 {
@storyweaver/api:dev:   currentGoal: 'ROUTINE_PATROL',
@storyweaver/api:dev:   emotionalState: undefined,
@storyweaver/api:dev:   stressLevel: undefined
@storyweaver/api:dev: ⚠️ 场景状态为 PAUSED，忽略动作: MOVE
@storyweaver/api:dev: }
@storyweaver/api:dev: 📊 [AIAgent] hero 叙事上下文已更新 { currentGoal: 'ROUTINE_PATROL', recentEventsCount: 1 }        
@storyweaver/api:dev: 🧠 [AIAgent] hero 开始智能决策规划 {
@storyweaver/api:dev:   isActive: true,
@storyweaver/api:dev:   hasCurrentScene: true,
@storyweaver/api:dev:   actionCount: 0,
@storyweaver/api:dev:   maxActions: 10,
@storyweaver/api:dev: ⚠️ 场景状态为 PAUSED，忽略动作: MOVE
@storyweaver/api:dev:   currentGoal: 'ROUTINE_PATROL'
@storyweaver/api:dev: }
@storyweaver/api:dev: 🧠 [AIAgent] hero 开始智能决策...
@storyweaver/api:dev: 🎯 [AIAgent] hero 基于目标生成动作 { goal: 'ROUTINE_PATROL' }
@storyweaver/api:dev: 📝 [AIAgent] hero 动作历史已更新 { actionType: 'MOVE', historyLength: 1 }
@storyweaver/api:dev: 🎯 [AIAgent] hero 收到增强行动请求 {
@storyweaver/api:dev:   timestamp: '2025-07-29T07:46:05.171Z',
@storyweaver/api:dev:   context: { sceneId: 'escape-dungeon', sceneState: 'RUNNING' },
@storyweaver/api:dev:   hasNarrativeLedger: true
@storyweaver/api:dev: }
@storyweaver/api:dev: 🎯 [AIAgent] hero 开始智能决策响应 {
@storyweaver/api:dev:   actionCount: 0,
@storyweaver/api:dev:   maxActions: 10,
@storyweaver/api:dev:   sceneId: 'escape-dungeon',
@storyweaver/api:dev:   hasNarrativeLedger: true
@storyweaver/api:dev: }
@storyweaver/api:dev: 🎭 [AIAgent] hero 角色组件已更新 {
@storyweaver/api:dev:   currentGoal: 'ROUTINE_PATROL',
@storyweaver/api:dev: ⚠️ 场景状态为 PAUSED，忽略动作: MOVE
@storyweaver/api:dev: ⚠️ 场景状态为 PAUSED，忽略动作: MOVE
@storyweaver/api:dev:   emotionalState: undefined,
@storyweaver/api:dev:   stressLevel: undefined
@storyweaver/api:dev: }
@storyweaver/api:dev: 📊 [AIAgent] hero 叙事上下文已更新 { currentGoal: 'ROUTINE_PATROL', recentEventsCount: 1 }        
@storyweaver/api:dev: 🧠 [AIAgent] hero 开始智能决策规划 {
@storyweaver/api:dev:   isActive: true,
@storyweaver/api:dev:   hasCurrentScene: true,
@storyweaver/api:dev:   actionCount: 0,
@storyweaver/api:dev:   maxActions: 10,
@storyweaver/api:dev:   currentGoal: 'ROUTINE_PATROL'
@storyweaver/api:dev: }
@storyweaver/api:dev: 🧠 [AIAgent] hero 开始智能决策...
@storyweaver/api:dev: 🎯 [AIAgent] hero 基于目标生成动作 { goal: 'ROUTINE_PATROL' }
@storyweaver/api:dev: 📝 [AIAgent] hero 动作历史已更新 { actionType: 'MOVE', historyLength: 1 }
@storyweaver/api:dev: 🎯 [AIAgent] hero 收到增强行动请求 {
@storyweaver/api:dev:   timestamp: '2025-07-29T07:46:05.171Z',
@storyweaver/api:dev:   context: { sceneId: 'escape-dungeon', sceneState: 'RUNNING' },
@storyweaver/api:dev:   hasNarrativeLedger: true
@storyweaver/api:dev: }
@storyweaver/api:dev: 🎯 [AIAgent] hero 开始智能决策响应 {
@storyweaver/api:dev:   actionCount: 0,
@storyweaver/api:dev:   maxActions: 10,
@storyweaver/api:dev:   sceneId: 'escape-dungeon',
@storyweaver/api:dev:   hasNarrativeLedger: true
@storyweaver/api:dev: }
@storyweaver/api:dev: 🎭 [AIAgent] hero 角色组件已更新 {
@storyweaver/api:dev:   currentGoal: 'ROUTINE_PATROL',
@storyweaver/api:dev:   emotionalState: undefined,
@storyweaver/api:dev:   stressLevel: undefined
@storyweaver/api:dev: }
@storyweaver/api:dev: 📊 [AIAgent] hero 叙事上下文已更新 { currentGoal: 'ROUTINE_PATROL', recentEventsCount: 1 }        
@storyweaver/api:dev: 🧠 [AIAgent] hero 开始智能决策规划 {
@storyweaver/api:dev:   isActive: true,
@storyweaver/api:dev:   hasCurrentScene: true,
@storyweaver/api:dev:   actionCount: 0,
@storyweaver/api:dev:   maxActions: 10,
@storyweaver/api:dev:   currentGoal: 'ROUTINE_PATROL'
@storyweaver/api:dev: }
@storyweaver/api:dev: 🧠 [AIAgent] hero 开始智能决策...
@storyweaver/api:dev: 🎯 [AIAgent] hero 基于目标生成动作 { goal: 'ROUTINE_PATROL' }
@storyweaver/api:dev: 📝 [AIAgent] hero 动作历史已更新 { actionType: 'MOVE', historyLength: 1 }
@storyweaver/api:dev: 🧊 [Director] 设置代理冷却 { agentId: 'hero', duration: 5000 }
@storyweaver/api:dev: ✅ AI代理 hero 生成动作成功 { actionType: 'MOVE', actionTarget: '牢房区域', actionCount: 1 }      
 
@storyweaver/api:dev: 🎭 Director: 收到AI_ACTION_PROPOSED事件 {
@storyweaver/api:dev:   agentId: 'hero',
@storyweaver/api:dev:   actionType: 'MOVE',
@storyweaver/api:dev:   timestamp: '2025-07-29T07:46:05.173Z'
@storyweaver/api:dev: }
@storyweaver/api:dev: 🎭 Director收到动作提议 {
@storyweaver/api:dev:   agentId: 'hero',
@storyweaver/api:dev:   actionType: 'MOVE',
@storyweaver/api:dev:   actionTarget: '牢房区域',
@storyweaver/api:dev:   sceneState: 'PAUSED',
@storyweaver/api:dev:   sceneId: 'escape-dungeon'
@storyweaver/api:dev: }
@storyweaver/api:dev: 🎭 Director: 收到AI_ACTION_PROPOSED事件 {
@storyweaver/api:dev:   agentId: 'hero',
@storyweaver/api:dev:   actionType: 'MOVE',
@storyweaver/api:dev:   timestamp: '2025-07-29T07:46:05.173Z'
@storyweaver/api:dev: }
@storyweaver/api:dev: 🎭 Director收到动作提议 {
@storyweaver/api:dev:   agentId: 'hero',
@storyweaver/api:dev:   actionType: 'MOVE',
@storyweaver/api:dev:   actionTarget: '牢房区域',
@storyweaver/api:dev:   sceneState: 'PAUSED',
@storyweaver/api:dev:   sceneId: 'escape-dungeon'
@storyweaver/api:dev: }
@storyweaver/api:dev: 🎭 Director: 收到AI_ACTION_PROPOSED事件 {
@storyweaver/api:dev:   agentId: 'hero',
@storyweaver/api:dev:   actionType: 'MOVE',
@storyweaver/api:dev:   timestamp: '2025-07-29T07:46:05.173Z'
@storyweaver/api:dev: }
@storyweaver/api:dev: 🎭 Director收到动作提议 {
@storyweaver/api:dev:   agentId: 'hero',
@storyweaver/api:dev:   actionType: 'MOVE',
@storyweaver/api:dev:   actionTarget: '牢房区域',
@storyweaver/api:dev:   sceneState: 'RUNNING',
@storyweaver/api:dev:   sceneId: 'escape-dungeon'
@storyweaver/api:dev: }
@storyweaver/api:dev: 🔍 验证动作相关性...
@storyweaver/api:dev: ✅ 动作相关性验证通过
@storyweaver/api:dev: 🎯 检查是否触发抉择点...
@storyweaver/api:dev: 🔍 检查抉择点 {
@storyweaver/api:dev:   sceneId: 'escape-dungeon',
@storyweaver/api:dev:   choicePointsCount: 1,
@storyweaver/api:dev:   agentId: 'hero',
@storyweaver/api:dev:   actionType: 'MOVE'
@storyweaver/api:dev: }
@storyweaver/api:dev: 🎯 检查抉择点: guard_encounter_choice {
@storyweaver/api:dev:   triggerCondition: { type: 'scene_event', event: 'guard_encounter' },
@storyweaver/api:dev:   actionType: 'MOVE',
@storyweaver/api:dev:   agentId: 'hero'
@storyweaver/api:dev: }
@storyweaver/api:dev: 🎪 事件映射检查 {
@storyweaver/api:dev:   targetEvent: 'guard_encounter',
@storyweaver/api:dev:   triggeringActions: [ 'MOVE', 'EXPLORE', 'LOOK_AROUND', 'PATROL' ],
@storyweaver/api:dev:   actionType: 'MOVE',
@storyweaver/api:dev:   matches: true
@storyweaver/api:dev: }
@storyweaver/api:dev: ✅ 动作 MOVE 触发事件 guard_encounter
@storyweaver/api:dev: 🎉 找到匹配的抉择点: guard_encounter_choice
@storyweaver/api:dev: 🔒 选择点 guard_encounter_choice 已加锁，防止重复触发
@storyweaver/api:dev: 🎪 发现新抉择点！开始两阶段流程 {
@storyweaver/api:dev:   choicePointId: 'guard_encounter_choice',
@storyweaver/api:dev:   description: '守卫正在巡逻，你需要决定如何行动',
@storyweaver/api:dev:   optionsCount: 3
@storyweaver/api:dev: }
@storyweaver/api:dev: 📖 阶段1：生成叙事铺垫...
@storyweaver/api:dev: 🎨 [Director] 事件驱动：为动作生成文学化叙述 { actionType: 'MOVE', actionTarget: '牢房区域' }     
@storyweaver/api:dev: 📡 [GameController] 收到NARRATIVE_READY事件 {
@storyweaver/api:dev:   type: 'narration',
@storyweaver/api:dev:   contentLength: 93,
@storyweaver/api:dev:   contentPreview: '沉重的脚步声在走廊中回响。一个身材魁梧的守卫出现在铁栅栏外，他的钥匙串在腰间叮 
当作响。守卫停下脚步，...',
@storyweaver/api:dev:   timestamp: '2025-07-29T07:46:05.174Z'
@storyweaver/api:dev: }
@storyweaver/api:dev: 📚 存储叙事内容 5ccd496b-9844-490e-99af-fb8a23d17bfb: {
@storyweaver/api:dev:   totalCount: 10,
@storyweaver/api:dev:   latestContent: '沉重的脚步声在走廊中回响。一个身材魁梧的守卫出现在铁栅栏外，他的钥匙串在腰间叮当
作响。守卫停下脚步，...'
@storyweaver/api:dev: }
@storyweaver/api:dev: ✅ [GameController] 已发送干净的叙事内容到前端
@storyweaver/api:dev: 📡 [GameController] 收到NARRATIVE_READY事件 {
@storyweaver/api:dev:   type: 'narration',
@storyweaver/api:dev:   contentLength: 93,
@storyweaver/api:dev:   contentPreview: '沉重的脚步声在走廊中回响。一个身材魁梧的守卫出现在铁栅栏外，他的钥匙串在腰间叮 
当作响。守卫停下脚步，...',
@storyweaver/api:dev:   timestamp: '2025-07-29T07:46:05.174Z'
@storyweaver/api:dev: }
@storyweaver/api:dev: ⚠️ 场景状态为 PAUSED，忽略动作: MOVE
@storyweaver/api:dev: 📚 存储叙事内容 9674ac7b-a315-4875-8874-2d45903927aa: {
@storyweaver/api:dev:   totalCount: 8,
@storyweaver/api:dev:   latestContent: '沉重的脚步声在走廊中回响。一个身材魁梧的守卫出现在铁栅栏外，他的钥匙串在腰间叮当
作响。守卫停下脚步，...'
@storyweaver/api:dev: }
@storyweaver/api:dev: ✅ [GameController] 已发送干净的叙事内容到前端
@storyweaver/api:dev: 📡 [GameController] 收到NARRATIVE_READY事件 {
@storyweaver/api:dev:   type: 'narration',
@storyweaver/api:dev: ⚠️ 场景状态为 PAUSED，忽略动作: MOVE
@storyweaver/api:dev:   contentLength: 93,
@storyweaver/api:dev:   contentPreview: '沉重的脚步声在走廊中回响。一个身材魁梧的守卫出现在铁栅栏外，他的钥匙串在腰间叮 
当作响。守卫停下脚步，...',
@storyweaver/api:dev:   timestamp: '2025-07-29T07:46:05.174Z'
@storyweaver/api:dev: }
@storyweaver/api:dev: 📚 存储叙事内容 e4b46d0e-f854-4ab4-bb14-2bce6a8a8731: {
@storyweaver/api:dev:   totalCount: 3,
@storyweaver/api:dev:   latestContent: '沉重的脚步声在走廊中回响。一个身材魁梧的守卫出现在铁栅栏外，他的钥匙串在腰间叮当
作响。守卫停下脚步，...'
@storyweaver/api:dev: }
@storyweaver/api:dev: ✅ [GameController] 已发送干净的叙事内容到前端
@storyweaver/api:dev: ✅ [Director] 已发布NARRATIVE_READY事件
@storyweaver/api:dev: 📢 [AIAgent] 事件驱动：发布AI_ACTION_PROPOSED事件 {
@storyweaver/api:dev:   agentId: 'hero',
@storyweaver/api:dev:   actionType: 'MOVE',
@storyweaver/api:dev:   timestamp: '2025-07-29T07:46:05.175Z'
@storyweaver/api:dev: }
@storyweaver/api:dev: 📝 AI代理 hero 记录动作历史: MOVE
@storyweaver/api:dev: ✅ AI代理 hero 生成动作成功 { actionType: 'MOVE', actionTarget: '牢房区域', actionCount: 1 }      
 
@storyweaver/api:dev: 🎭 Director: 收到AI_ACTION_PROPOSED事件 {
@storyweaver/api:dev:   agentId: 'hero',
@storyweaver/api:dev:   actionType: 'MOVE',
@storyweaver/api:dev:   timestamp: '2025-07-29T07:46:05.175Z'
@storyweaver/api:dev: }
@storyweaver/api:dev: 🎭 Director收到动作提议 {
@storyweaver/api:dev:   agentId: 'hero',
@storyweaver/api:dev:   actionType: 'MOVE',
@storyweaver/api:dev:   actionTarget: '牢房区域',
@storyweaver/api:dev:   sceneState: 'PAUSED',
@storyweaver/api:dev:   sceneId: 'escape-dungeon'
@storyweaver/api:dev: }
@storyweaver/api:dev: 🎭 Director: 收到AI_ACTION_PROPOSED事件 {
@storyweaver/api:dev:   agentId: 'hero',
@storyweaver/api:dev:   actionType: 'MOVE',
@storyweaver/api:dev:   timestamp: '2025-07-29T07:46:05.175Z'
@storyweaver/api:dev: }
@storyweaver/api:dev: 🎭 Director收到动作提议 {
@storyweaver/api:dev:   agentId: 'hero',
@storyweaver/api:dev:   actionType: 'MOVE',
@storyweaver/api:dev:   actionTarget: '牢房区域',
@storyweaver/api:dev:   sceneState: 'PAUSED',
@storyweaver/api:dev:   sceneId: 'escape-dungeon'
@storyweaver/api:dev: }
@storyweaver/api:dev: 🎭 Director: 收到AI_ACTION_PROPOSED事件 {
@storyweaver/api:dev:   agentId: 'hero',
@storyweaver/api:dev:   actionType: 'MOVE',
@storyweaver/api:dev:   timestamp: '2025-07-29T07:46:05.175Z'
@storyweaver/api:dev: }
@storyweaver/api:dev: 🎭 Director收到动作提议 {
@storyweaver/api:dev:   agentId: 'hero',
@storyweaver/api:dev:   actionType: 'MOVE',
@storyweaver/api:dev:   actionTarget: '牢房区域',
@storyweaver/api:dev:   sceneState: 'RUNNING',
@storyweaver/api:dev:   sceneId: 'escape-dungeon'
@storyweaver/api:dev: }
@storyweaver/api:dev: 🔍 验证动作相关性...
@storyweaver/api:dev: ✅ 动作相关性验证通过
@storyweaver/api:dev: 🎯 检查是否触发抉择点...
@storyweaver/api:dev: 🔍 检查抉择点 {
@storyweaver/api:dev:   sceneId: 'escape-dungeon',
@storyweaver/api:dev:   choicePointsCount: 1,
@storyweaver/api:dev:   agentId: 'hero',
@storyweaver/api:dev:   actionType: 'MOVE'
@storyweaver/api:dev: }
@storyweaver/api:dev: 🎯 检查抉择点: guard_encounter_choice {
@storyweaver/api:dev:   triggerCondition: { type: 'scene_event', event: 'guard_encounter' },
@storyweaver/api:dev:   actionType: 'MOVE',
@storyweaver/api:dev:   agentId: 'hero'
@storyweaver/api:dev: }
@storyweaver/api:dev: 🎪 事件映射检查 {
@storyweaver/api:dev:   targetEvent: 'guard_encounter',
@storyweaver/api:dev:   triggeringActions: [ 'MOVE', 'EXPLORE', 'LOOK_AROUND', 'PATROL' ],
@storyweaver/api:dev:   actionType: 'MOVE',
@storyweaver/api:dev:   matches: true
@storyweaver/api:dev: }
@storyweaver/api:dev: ✅ 动作 MOVE 触发事件 guard_encounter
@storyweaver/api:dev: 🎉 找到匹配的抉择点: guard_encounter_choice
@storyweaver/api:dev: 🔒 选择点 guard_encounter_choice 已触发过，直接执行动作
@storyweaver/api:dev: 执行动作: MOVE
@storyweaver/api:dev: 📢 [AIAgent] 事件驱动：发布AI_ACTION_PROPOSED事件 {
@storyweaver/api:dev:   agentId: 'hero',
@storyweaver/api:dev:   actionType: 'MOVE',
@storyweaver/api:dev:   timestamp: '2025-07-29T07:46:05.176Z'
@storyweaver/api:dev: }
@storyweaver/api:dev: 📝 AI代理 hero 记录动作历史: MOVE
@storyweaver/api:dev: ✅ AI代理 hero 生成动作成功 { actionType: 'MOVE', actionTarget: '牢房区域', actionCount: 1 }      
 
@storyweaver/api:dev: 🎭 Director: 收到AI_ACTION_PROPOSED事件 {
@storyweaver/api:dev:   agentId: 'hero',
@storyweaver/api:dev:   actionType: 'MOVE',
@storyweaver/api:dev:   timestamp: '2025-07-29T07:46:05.176Z'
@storyweaver/api:dev: }
@storyweaver/api:dev: 🎭 Director收到动作提议 {
@storyweaver/api:dev:   agentId: 'hero',
@storyweaver/api:dev:   actionType: 'MOVE',
@storyweaver/api:dev:   actionTarget: '牢房区域',
@storyweaver/api:dev:   sceneState: 'PAUSED',
@storyweaver/api:dev:   sceneId: 'escape-dungeon'
@storyweaver/api:dev: }
@storyweaver/api:dev: 🎭 Director: 收到AI_ACTION_PROPOSED事件 {
@storyweaver/api:dev:   agentId: 'hero',
@storyweaver/api:dev:   actionType: 'MOVE',
@storyweaver/api:dev:   timestamp: '2025-07-29T07:46:05.176Z'
@storyweaver/api:dev: }
@storyweaver/api:dev: 🎭 Director收到动作提议 {
@storyweaver/api:dev:   agentId: 'hero',
@storyweaver/api:dev:   actionType: 'MOVE',
@storyweaver/api:dev:   actionTarget: '牢房区域',
@storyweaver/api:dev:   sceneState: 'PAUSED',
@storyweaver/api:dev:   sceneId: 'escape-dungeon'
@storyweaver/api:dev: }
@storyweaver/api:dev: 🎭 Director: 收到AI_ACTION_PROPOSED事件 {
@storyweaver/api:dev:   agentId: 'hero',
@storyweaver/api:dev:   actionType: 'MOVE',
@storyweaver/api:dev:   timestamp: '2025-07-29T07:46:05.176Z'
@storyweaver/api:dev: }
@storyweaver/api:dev: 🎭 Director收到动作提议 {
@storyweaver/api:dev:   agentId: 'hero',
@storyweaver/api:dev:   actionType: 'MOVE',
@storyweaver/api:dev:   actionTarget: '牢房区域',
@storyweaver/api:dev:   sceneState: 'RUNNING',
@storyweaver/api:dev:   sceneId: 'escape-dungeon'
@storyweaver/api:dev: }
@storyweaver/api:dev: 🔍 验证动作相关性...
@storyweaver/api:dev: ✅ 动作相关性验证通过
@storyweaver/api:dev: 🎯 检查是否触发抉择点...
@storyweaver/api:dev: 🔍 检查抉择点 {
@storyweaver/api:dev:   sceneId: 'escape-dungeon',
@storyweaver/api:dev:   choicePointsCount: 1,
@storyweaver/api:dev:   agentId: 'hero',
@storyweaver/api:dev:   actionType: 'MOVE'
@storyweaver/api:dev: }
@storyweaver/api:dev: 🎯 检查抉择点: guard_encounter_choice {
@storyweaver/api:dev:   triggerCondition: { type: 'scene_event', event: 'guard_encounter' },
@storyweaver/api:dev:   actionType: 'MOVE',
@storyweaver/api:dev:   agentId: 'hero'
@storyweaver/api:dev: }
@storyweaver/api:dev: 🎪 事件映射检查 {
@storyweaver/api:dev:   targetEvent: 'guard_encounter',
@storyweaver/api:dev:   triggeringActions: [ 'MOVE', 'EXPLORE', 'LOOK_AROUND', 'PATROL' ],
@storyweaver/api:dev:   actionType: 'MOVE',
@storyweaver/api:dev:   matches: true
@storyweaver/api:dev: }
@storyweaver/api:dev: ✅ 动作 MOVE 触发事件 guard_encounter
@storyweaver/api:dev: 🎉 找到匹配的抉择点: guard_encounter_choice
@storyweaver/api:dev: 🔒 选择点 guard_encounter_choice 已触发过，直接执行动作
@storyweaver/api:dev: 📢 [AIAgent] 事件驱动：发布AI_ACTION_PROPOSED事件 {
@storyweaver/api:dev:   agentId: 'hero',
@storyweaver/api:dev:   actionType: 'MOVE',
@storyweaver/api:dev:   timestamp: '2025-07-29T07:46:05.186Z'
@storyweaver/api:dev: }
@storyweaver/api:dev: 📝 AI代理 hero 记录动作历史: MOVE
@storyweaver/api:dev: ✅ 阶段1：叙事内容生成完成 { duration: 13, timestamp: '2025-07-29T07:46:05.187Z' }
@storyweaver/api:dev: ⏰ 阶段2：准备延迟触发选择点...
@storyweaver/api:dev: 🎨 [Director] 事件驱动：为动作生成文学化叙述 { actionType: 'MOVE', actionTarget: '牢房区域' }     
@storyweaver/api:dev: 📡 [GameController] 收到NARRATIVE_READY事件 {
@storyweaver/api:dev:   type: 'narration',
@storyweaver/api:dev:   contentLength: 93,
@storyweaver/api:dev:   contentPreview: '沉重的脚步声在走廊中回响。一个身材魁梧的守卫出现在铁栅栏外，他的钥匙串在腰间叮 
当作响。守卫停下脚步，...',
@storyweaver/api:dev:   timestamp: '2025-07-29T07:46:05.187Z'
@storyweaver/api:dev: }
@storyweaver/api:dev: 📚 存储叙事内容 5ccd496b-9844-490e-99af-fb8a23d17bfb: {
@storyweaver/api:dev:   totalCount: 10,
@storyweaver/api:dev:   latestContent: '沉重的脚步声在走廊中回响。一个身材魁梧的守卫出现在铁栅栏外，他的钥匙串在腰间叮当
作响。守卫停下脚步，...'
@storyweaver/api:dev: }
@storyweaver/api:dev: ✅ [GameController] 已发送干净的叙事内容到前端
@storyweaver/api:dev: 📡 [GameController] 收到NARRATIVE_READY事件 {
@storyweaver/api:dev:   type: 'narration',
@storyweaver/api:dev:   contentLength: 93,
@storyweaver/api:dev:   contentPreview: '沉重的脚步声在走廊中回响。一个身材魁梧的守卫出现在铁栅栏外，他的钥匙串在腰间叮 
当作响。守卫停下脚步，...',
@storyweaver/api:dev:   timestamp: '2025-07-29T07:46:05.187Z'
@storyweaver/api:dev: }
@storyweaver/api:dev: 📚 存储叙事内容 9674ac7b-a315-4875-8874-2d45903927aa: {
@storyweaver/api:dev:   totalCount: 9,
@storyweaver/api:dev:   latestContent: '沉重的脚步声在走廊中回响。一个身材魁梧的守卫出现在铁栅栏外，他的钥匙串在腰间叮当
作响。守卫停下脚步，...'
@storyweaver/api:dev: }
@storyweaver/api:dev: ✅ [GameController] 已发送干净的叙事内容到前端
@storyweaver/api:dev: 📡 [GameController] 收到NARRATIVE_READY事件 {
@storyweaver/api:dev:   type: 'narration',
@storyweaver/api:dev:   contentLength: 93,
@storyweaver/api:dev:   contentPreview: '沉重的脚步声在走廊中回响。一个身材魁梧的守卫出现在铁栅栏外，他的钥匙串在腰间叮 
当作响。守卫停下脚步，...',
@storyweaver/api:dev:   timestamp: '2025-07-29T07:46:05.187Z'
@storyweaver/api:dev: }
@storyweaver/api:dev: 📚 存储叙事内容 e4b46d0e-f854-4ab4-bb14-2bce6a8a8731: {
@storyweaver/api:dev:   totalCount: 4,
@storyweaver/api:dev:   latestContent: '沉重的脚步声在走廊中回响。一个身材魁梧的守卫出现在铁栅栏外，他的钥匙串在腰间叮当
作响。守卫停下脚步，...'
@storyweaver/api:dev: }
@storyweaver/api:dev: ✅ [GameController] 已发送干净的叙事内容到前端
@storyweaver/api:dev: ✅ [Director] 已发布NARRATIVE_READY事件
@storyweaver/api:dev: 执行动作: MOVE
@storyweaver/api:dev: 🎨 [Director] 事件驱动：为动作生成文学化叙述 { actionType: 'MOVE', actionTarget: '牢房区域' }     
@storyweaver/api:dev: 📡 [GameController] 收到NARRATIVE_READY事件 {
@storyweaver/api:dev:   type: 'narration',
@storyweaver/api:dev:   contentLength: 93,
@storyweaver/api:dev:   contentPreview: '沉重的脚步声在走廊中回响。一个身材魁梧的守卫出现在铁栅栏外，他的钥匙串在腰间叮 
当作响。守卫停下脚步，...',
@storyweaver/api:dev:   timestamp: '2025-07-29T07:46:05.188Z'
@storyweaver/api:dev: }
@storyweaver/api:dev: 📚 存储叙事内容 5ccd496b-9844-490e-99af-fb8a23d17bfb: {
@storyweaver/api:dev:   totalCount: 10,
@storyweaver/api:dev:   latestContent: '沉重的脚步声在走廊中回响。一个身材魁梧的守卫出现在铁栅栏外，他的钥匙串在腰间叮当
作响。守卫停下脚步，...'
@storyweaver/api:dev: }
@storyweaver/api:dev: ✅ [GameController] 已发送干净的叙事内容到前端
@storyweaver/api:dev: 📡 [GameController] 收到NARRATIVE_READY事件 {
@storyweaver/api:dev:   type: 'narration',
@storyweaver/api:dev:   contentLength: 93,
@storyweaver/api:dev:   contentPreview: '沉重的脚步声在走廊中回响。一个身材魁梧的守卫出现在铁栅栏外，他的钥匙串在腰间叮 
当作响。守卫停下脚步，...',
@storyweaver/api:dev:   timestamp: '2025-07-29T07:46:05.188Z'
@storyweaver/api:dev: }
@storyweaver/api:dev: 📚 存储叙事内容 9674ac7b-a315-4875-8874-2d45903927aa: {
@storyweaver/api:dev:   totalCount: 10,
@storyweaver/api:dev:   latestContent: '沉重的脚步声在走廊中回响。一个身材魁梧的守卫出现在铁栅栏外，他的钥匙串在腰间叮当
作响。守卫停下脚步，...'
@storyweaver/api:dev: }
@storyweaver/api:dev: ✅ [GameController] 已发送干净的叙事内容到前端
@storyweaver/api:dev: 📡 [GameController] 收到NARRATIVE_READY事件 {
@storyweaver/api:dev:   type: 'narration',
@storyweaver/api:dev:   contentLength: 93,
@storyweaver/api:dev:   contentPreview: '沉重的脚步声在走廊中回响。一个身材魁梧的守卫出现在铁栅栏外，他的钥匙串在腰间叮 
当作响。守卫停下脚步，...',
@storyweaver/api:dev:   timestamp: '2025-07-29T07:46:05.188Z'
@storyweaver/api:dev: }
@storyweaver/api:dev: 📚 存储叙事内容 e4b46d0e-f854-4ab4-bb14-2bce6a8a8731: {
@storyweaver/api:dev:   totalCount: 5,
@storyweaver/api:dev:   latestContent: '沉重的脚步声在走廊中回响。一个身材魁梧的守卫出现在铁栅栏外，他的钥匙串在腰间叮当
作响。守卫停下脚步，...'
@storyweaver/api:dev: }
@storyweaver/api:dev: ✅ [GameController] 已发送干净的叙事内容到前端
@storyweaver/api:dev: ✅ [Director] 已发布NARRATIVE_READY事件
@storyweaver/api:dev: ✅ 游戏 e4b46d0e-f854-4ab4-bb14-2bce6a8a8731 启动完成
@storyweaver/api:dev: 📊 当前叙事历史长度: 1
@storyweaver/api:dev: 🎮 AI代理状态: [
@storyweaver/api:dev:   {
@storyweaver/api:dev:     id: 'hero',
@storyweaver/api:dev:     status: {
@storyweaver/api:dev:       id: 'hero',
@storyweaver/api:dev:       isActive: true,
@storyweaver/api:dev:       currentScene: 'escape-dungeon',
@storyweaver/api:dev: ⚠️ 场景状态为 PAUSED，忽略动作: MOVE
@storyweaver/api:dev: ⚠️ 场景状态为 PAUSED，忽略动作: MOVE
@storyweaver/api:dev:       actionCount: 1,
@storyweaver/api:dev:       character: [Object]
@storyweaver/api:dev:     }
@storyweaver/api:dev:   },
@storyweaver/api:dev:   {
@storyweaver/api:dev:     id: 'guard',
@storyweaver/api:dev:     status: {
@storyweaver/api:dev:       id: 'guard',
@storyweaver/api:dev:       isActive: true,
@storyweaver/api:dev:       currentScene: 'escape-dungeon',
@storyweaver/api:dev:       actionCount: 0,
@storyweaver/api:dev:       character: [Object]
@storyweaver/api:dev:     }
@storyweaver/api:dev:   }
@storyweaver/api:dev: ]
@storyweaver/api:dev: 🎯 强制触发AI代理动作...
@storyweaver/api:dev: 🎭 强制触发guard代理动作
@storyweaver/api:dev: 📢 发布强制动作事件 {
@storyweaver/api:dev:   type: 'MOVE',
@storyweaver/api:dev:   target: '牢房区域',
@storyweaver/api:dev:   parameters: { reasoning: '巡逻检查牢房', expected_outcome: '发现异常情况' }
@storyweaver/api:dev: }
@storyweaver/api:dev: 🎭 Director: 收到AI_ACTION_PROPOSED事件 {
@storyweaver/api:dev:   agentId: 'guard',
@storyweaver/api:dev:   actionType: 'MOVE',
@storyweaver/api:dev:   timestamp: '2025-07-29T07:46:06.320Z'
@storyweaver/api:dev: }
@storyweaver/api:dev: 🎭 Director收到动作提议 {
@storyweaver/api:dev:   agentId: 'guard',
@storyweaver/api:dev:   actionType: 'MOVE',
@storyweaver/api:dev:   actionTarget: '牢房区域',
@storyweaver/api:dev:   sceneState: 'PAUSED',
@storyweaver/api:dev:   sceneId: 'escape-dungeon'
@storyweaver/api:dev: }
@storyweaver/api:dev: 🎭 Director: 收到AI_ACTION_PROPOSED事件 {
@storyweaver/api:dev:   agentId: 'guard',
@storyweaver/api:dev:   actionType: 'MOVE',
@storyweaver/api:dev:   timestamp: '2025-07-29T07:46:06.320Z'
@storyweaver/api:dev: }
@storyweaver/api:dev: 🎭 Director收到动作提议 {
@storyweaver/api:dev:   agentId: 'guard',
@storyweaver/api:dev:   actionType: 'MOVE',
@storyweaver/api:dev:   actionTarget: '牢房区域',
@storyweaver/api:dev:   sceneState: 'PAUSED',
@storyweaver/api:dev:   sceneId: 'escape-dungeon'
@storyweaver/api:dev: }
@storyweaver/api:dev: 🎭 Director: 收到AI_ACTION_PROPOSED事件 {
@storyweaver/api:dev:   agentId: 'guard',
@storyweaver/api:dev:   actionType: 'MOVE',
@storyweaver/api:dev:   timestamp: '2025-07-29T07:46:06.320Z'
@storyweaver/api:dev: }
@storyweaver/api:dev: 🎭 Director收到动作提议 {
@storyweaver/api:dev:   agentId: 'guard',
@storyweaver/api:dev:   actionType: 'MOVE',
@storyweaver/api:dev:   actionTarget: '牢房区域',
@storyweaver/api:dev:   sceneState: 'RUNNING',
@storyweaver/api:dev:   sceneId: 'escape-dungeon'
@storyweaver/api:dev: }
@storyweaver/api:dev: 🔍 验证动作相关性...
@storyweaver/api:dev: ✅ 动作相关性验证通过
@storyweaver/api:dev: 🎯 检查是否触发抉择点...
@storyweaver/api:dev: 🔍 检查抉择点 {
@storyweaver/api:dev:   sceneId: 'escape-dungeon',
@storyweaver/api:dev:   choicePointsCount: 1,
@storyweaver/api:dev:   agentId: 'guard',
@storyweaver/api:dev:   actionType: 'MOVE'
@storyweaver/api:dev: }
@storyweaver/api:dev: 🎯 检查抉择点: guard_encounter_choice {
@storyweaver/api:dev:   triggerCondition: { type: 'scene_event', event: 'guard_encounter' },
@storyweaver/api:dev:   actionType: 'MOVE',
@storyweaver/api:dev:   agentId: 'guard'
@storyweaver/api:dev: }
@storyweaver/api:dev: 🎪 事件映射检查 {
@storyweaver/api:dev:   targetEvent: 'guard_encounter',
@storyweaver/api:dev:   triggeringActions: [ 'MOVE', 'EXPLORE', 'LOOK_AROUND', 'PATROL' ],
@storyweaver/api:dev:   actionType: 'MOVE',
@storyweaver/api:dev:   matches: true
@storyweaver/api:dev: }
@storyweaver/api:dev: ✅ 动作 MOVE 触发事件 guard_encounter
@storyweaver/api:dev: 🎉 找到匹配的抉择点: guard_encounter_choice
@storyweaver/api:dev: 🔒 选择点 guard_encounter_choice 已触发过，直接执行动作
@storyweaver/api:dev: 执行动作: MOVE
@storyweaver/api:dev: 🎨 [Director] 事件驱动：为动作生成文学化叙述 { actionType: 'MOVE', actionTarget: '牢房区域' }     
@storyweaver/api:dev: 📡 [GameController] 收到NARRATIVE_READY事件 {
@storyweaver/api:dev:   type: 'narration',
@storyweaver/api:dev:   contentLength: 93,
@storyweaver/api:dev:   contentPreview: '沉重的脚步声在走廊中回响。一个身材魁梧的守卫出现在铁栅栏外，他的钥匙串在腰间叮 
当作响。守卫停下脚步，...',
@storyweaver/api:dev:   timestamp: '2025-07-29T07:46:06.320Z'
@storyweaver/api:dev: }
@storyweaver/api:dev: 📚 存储叙事内容 5ccd496b-9844-490e-99af-fb8a23d17bfb: {
@storyweaver/api:dev:   totalCount: 10,
@storyweaver/api:dev:   latestContent: '沉重的脚步声在走廊中回响。一个身材魁梧的守卫出现在铁栅栏外，他的钥匙串在腰间叮当
作响。守卫停下脚步，...'
@storyweaver/api:dev: }
@storyweaver/api:dev: ✅ [GameController] 已发送干净的叙事内容到前端
@storyweaver/api:dev: 📡 [GameController] 收到NARRATIVE_READY事件 {
@storyweaver/api:dev:   type: 'narration',
@storyweaver/api:dev:   contentLength: 93,
@storyweaver/api:dev:   contentPreview: '沉重的脚步声在走廊中回响。一个身材魁梧的守卫出现在铁栅栏外，他的钥匙串在腰间叮 
当作响。守卫停下脚步，...',
@storyweaver/api:dev:   timestamp: '2025-07-29T07:46:06.320Z'
@storyweaver/api:dev: }
@storyweaver/api:dev: 📚 存储叙事内容 9674ac7b-a315-4875-8874-2d45903927aa: {
@storyweaver/api:dev:   totalCount: 10,
@storyweaver/api:dev:   latestContent: '沉重的脚步声在走廊中回响。一个身材魁梧的守卫出现在铁栅栏外，他的钥匙串在腰间叮当
作响。守卫停下脚步，...'
@storyweaver/api:dev: }
@storyweaver/api:dev: ✅ [GameController] 已发送干净的叙事内容到前端
@storyweaver/api:dev: 📡 [GameController] 收到NARRATIVE_READY事件 {
@storyweaver/api:dev:   type: 'narration',
@storyweaver/api:dev:   contentLength: 93,
@storyweaver/api:dev:   contentPreview: '沉重的脚步声在走廊中回响。一个身材魁梧的守卫出现在铁栅栏外，他的钥匙串在腰间叮 
当作响。守卫停下脚步，...',
@storyweaver/api:dev:   timestamp: '2025-07-29T07:46:06.320Z'
@storyweaver/api:dev: }
@storyweaver/api:dev: 📚 存储叙事内容 e4b46d0e-f854-4ab4-bb14-2bce6a8a8731: {
@storyweaver/api:dev:   totalCount: 6,
@storyweaver/api:dev:   latestContent: '沉重的脚步声在走廊中回响。一个身材魁梧的守卫出现在铁栅栏外，他的钥匙串在腰间叮当
作响。守卫停下脚步，...'
@storyweaver/api:dev: }
@storyweaver/api:dev: ✅ [GameController] 已发送干净的叙事内容到前端
@storyweaver/api:dev: ✅ [Director] 已发布NARRATIVE_READY事件
@storyweaver/api:dev: 客户端连接: VdQNUEhJpl4m8K0rAAID
@storyweaver/api:dev: 客户端 VdQNUEhJpl4m8K0rAAID 加入游戏 e4b46d0e-f854-4ab4-bb14-2bce6a8a8731
@storyweaver/api:dev: 🎪 阶段2：延迟时间到，开始触发选择点
@storyweaver/api:dev: 🎪 阶段2：触发延迟选择点 {
@storyweaver/api:dev:   choicePointId: 'guard_encounter_choice',
@storyweaver/api:dev:   agentId: 'hero',
@storyweaver/api:dev:   actionType: 'MOVE',
@storyweaver/api:dev:   timestamp: '2025-07-29T07:46:07.187Z',
@storyweaver/api:dev:   delayCompleted: true
@storyweaver/api:dev: }
@storyweaver/api:dev: 🔒 [Director] 触发选择点 guard_encounter_choice 并上锁，等待玩家响应
@storyweaver/api:dev: ⏸️ 场景已暂停，等待玩家选择
@storyweaver/api:dev: ⚠️ 已有待处理的选择，忽略新的抉择点
@storyweaver/api:dev: ⚠️ 已有待处理的选择，忽略新的抉择点
@storyweaver/api:dev: 📋 生成选择选项 [
@storyweaver/api:dev:   {
@storyweaver/api:dev:     id: 'attack_guard',
@storyweaver/api:dev:     text: '直接攻击守卫',
@storyweaver/api:dev:     action: { type: 'ATTACK', target: 'guard', parameters: [Object] }
@storyweaver/api:dev:   },
@storyweaver/api:dev:   {
@storyweaver/api:dev:     id: 'sneak_past',
@storyweaver/api:dev:     text: '尝试悄悄绕过守卫',
@storyweaver/api:dev:     action: { type: 'SNEAK_PAST', target: 'guard', parameters: [Object] }
@storyweaver/api:dev:   },
@storyweaver/api:dev:   {
@storyweaver/api:dev:     id: 'distract_guard',
@storyweaver/api:dev:     text: '制造声响分散注意力',
@storyweaver/api:dev:     action: { type: 'DISTRACT', target: 'guard', parameters: [Object] }
@storyweaver/api:dev:   }
@storyweaver/api:dev: ]
@storyweaver/api:dev: 🎪 PlayerInterventionHandler收到抉择点事件 {
@storyweaver/api:dev:   choicePointId: 'guard_encounter_choice',
@storyweaver/api:dev:   optionsCount: 3,
@storyweaver/api:dev:   isWaitingForChoice: true,
@storyweaver/api:dev:   hasOnChoiceRequiredCallback: true
@storyweaver/api:dev: }
@storyweaver/api:dev: 🎪 PlayerInterventionHandler收到抉择点事件 {
@storyweaver/api:dev:   choicePointId: 'guard_encounter_choice',
@storyweaver/api:dev:   optionsCount: 3,
@storyweaver/api:dev:   isWaitingForChoice: true,
@storyweaver/api:dev:   hasOnChoiceRequiredCallback: true
@storyweaver/api:dev: }
@storyweaver/api:dev: 🎪 PlayerInterventionHandler收到抉择点事件 {
@storyweaver/api:dev:   choicePointId: 'guard_encounter_choice',
@storyweaver/api:dev:   optionsCount: 3,
@storyweaver/api:dev:   isWaitingForChoice: false,
@storyweaver/api:dev:   hasOnChoiceRequiredCallback: true
@storyweaver/api:dev: }
@storyweaver/api:dev: 🎯 处理抉择点: guard_encounter_choice
@storyweaver/api:dev: 📋 选择选项: [
@storyweaver/api:dev:   { id: 'attack_guard', text: '直接攻击守卫' },
@storyweaver/api:dev:   { id: 'sneak_past', text: '尝试悄悄绕过守卫' },
@storyweaver/api:dev:   { id: 'distract_guard', text: '制造声响分散注意力' }
@storyweaver/api:dev: ]
@storyweaver/api:dev: ⏳ 设置等待选择状态
@storyweaver/api:dev: ⏰ 设置选择超时: 300秒 (5分钟)
@storyweaver/api:dev: 📢 调用外部选择需求回调
@storyweaver/api:dev: 发送选择点事件: guard_encounter_choice
@storyweaver/api:dev: ✅ 等待玩家选择，选项数量: 3
@storyweaver/api:dev: 📢 已发布延迟抉择点事件 {
@storyweaver/api:dev:   choicePointId: 'guard_encounter_choice',
@storyweaver/api:dev:   description: '守卫正在巡逻，你需要决定如何行动',
@storyweaver/api:dev:   timestamp: '2025-07-29T07:46:07.189Z',
@storyweaver/api:dev:   source: 'delayed_trigger'
@storyweaver/api:dev: }
@storyweaver/api:dev: 🔄 为客户端 VdQNUEhJpl4m8K0rAAID 重新发送叙事内容
@storyweaver/api:dev: 📚 找到 6 条历史叙事内容，准备重新发送
@storyweaver/api:dev: 📡 重新发送叙事内容 1/6 给客户端 VdQNUEhJpl4m8K0rAAID: 远处传来脚步声，沉重而有节奏。有人正在接近
这里。...
@storyweaver/api:dev: 📡 重新发送叙事内容 2/6 给客户端 VdQNUEhJpl4m8K0rAAID: 微弱的光线从走廊尽头透过来，照亮了地面上的
水渍和散落的稻草。...
@storyweaver/api:dev: 🔒 [Director] 静默等待用户选择中... { waitingFor: 'guard_encounter_choice', waitingTime: '1753775168s' }
@storyweaver/api:dev: 📡 重新发送叙事内容 3/6 给客户端 VdQNUEhJpl4m8K0rAAID: 沉重的脚步声在走廊中回响。一个身材魁梧的守
卫出现在铁栅栏外，他的钥匙串在腰间叮当作响。守卫停下脚步，...
@storyweaver/api:dev: 🔒 [Director] 静默等待用户选择中... { waitingFor: 'guard_encounter_choice', waitingTime: '30s' }
@storyweaver/api:dev: 📡 重新发送叙事内容 4/6 给客户端 VdQNUEhJpl4m8K0rAAID: 沉重的脚步声在走廊中回响。一个身材魁梧的守
卫出现在铁栅栏外，他的钥匙串在腰间叮当作响。守卫停下脚步，...
@storyweaver/api:dev: 📡 重新发送叙事内容 5/6 给客户端 VdQNUEhJpl4m8K0rAAID: 沉重的脚步声在走廊中回响。一个身材魁梧的守
卫出现在铁栅栏外，他的钥匙串在腰间叮当作响。守卫停下脚步，...
@storyweaver/api:dev: 📡 重新发送叙事内容 6/6 给客户端 VdQNUEhJpl4m8K0rAAID: 沉重的脚步声在走廊中回响。一个身材魁梧的守
卫出现在铁栅栏外，他的钥匙串在腰间叮当作响。守卫停下脚步，...
@storyweaver/api:dev: 🔥 [Director] 代理冷却结束 { agentId: 'hero' }
@storyweaver/api:dev: 🔒 [Director] 静默等待用户选择中... { waitingFor: 'guard_encounter_choice', waitingTime: '30s' }
@storyweaver/api:dev: 🔒 [Director] 静默等待用户选择中... { waitingFor: 'guard_encounter_choice', waitingTime: '30s' }
@storyweaver/api:dev: 🔒 [Director] 静默等待用户选择中... { waitingFor: 'guard_encounter_choice', waitingTime: '30s' }
@storyweaver/api:dev: 🔒 [Director] 静默等待用户选择中... { waitingFor: 'guard_encounter_choice', waitingTime: '30s' }
@storyweaver/api:dev: 🔒 [Director] 静默等待用户选择中... { waitingFor: 'guard_encounter_choice', waitingTime: '30s' }
@storyweaver/api:dev: 🔒 [Director] 静默等待用户选择中... { waitingFor: 'guard_encounter_choice', waitingTime: '30s' }